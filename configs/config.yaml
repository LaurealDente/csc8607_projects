dataset:
  name: imagenet
  root: "zh-plus/tiny-imagenet"
  split:
    train:
      p: 0.9
      chemin: data/preprocessed_dataset_train.pt
    val: 
      p: 0
      chemin: data/preprocessed_dataset_valid.pt
    test: 
      p: 0.1
      chemin: data/preprocessed_dataset_test.pt
  download: true
  num_workers: 8
  shuffle: true
  columns:
    label: label
    image : image

preprocess:

  resize: null
  normalize: True
  text_tokenizer: null

perte_model:
  model : 
    residual_blocks : [3,3,3]
    dropout : 0.1
    num_classes : 200
    residual : true
    batch_norm : true
    activation : relu

augment:
  random_flip: true
  random_crop:  
    size: [64, 64]
    scale: [0.8,1.0]
    ratio: [0.9,1.1]
  color_jitter:
    brightness: 0.4
    contrast: 0.4
    saturation: 0.4
    hue: 0.1
  rotation:
    degrees: 15
    p: 0.5

model:
  type: Convolutional Neural Network - Residual Network 
  num_classes: 200
  in_channels: 3
  input_shape: [32,3,64,64]
  hidden_sizes: [64,64,128,256,200]
  activation: relu
  stage_widths: [64, 128, 256]
  batch_norm: True
  residual: True
  final_test : 
    A :
      dropout : 0.1
      residual_blocks : [3,3,3] 
    B :
      dropout : 0.1
      residual_blocks : [2,2,2]
    Special:
      dropout : 0.3
      residual_blocks : [3,3,3]


grid_final:
  epochs: 100
  base_model:
    residual_blocks: [3, 3, 3] 
    dropout: 0.1
  lr: 0.0001
  weight_decay: 0.0001
  lr_high: 0.0005
  weight_decay_high: 0.001
  blocks_high: [4, 4, 4]
  dropout_high: 0.3  


train:
  seed: 42
  device: cuda
  batch_size: 32
  epochs: 100
  max_steps: null
  overfit_small: false
  overfit_epochs : 100
  finder_start_lr: 1.0e-8 
  taille_finder: 10000
  early_stopping_patience : 100
  warmup_epochs: 5
  first_cycle_epochs: 20
  t_mult: 2

  optimizer:
    name: adam              # sgd/adam/rmsprop
    lr: 0.001
    weight_decay: 0.0
    over_weight_decay: 0.0
    momentum: 0.9           # utile si SGD

  scheduler:
    name: none              # none/step/cosine/onecycle
    step_size: 10
    gamma: 0.1
    warmup_steps: 0

metrics:
  classification:           # ex: ["accuracy", "f1"]
    - accuracy
  regression: []            # ex: ["mae", "rmse"]

hparams:                    # espace pour mini grid search
  lr: [0.0005, 0.001, 0.005]
  num_blocks: [2,3] 
  batch_size: [32, 64]
  weight_decay: [0.0, 0.0005]

grid_search:
  hparams:
    lr: [0.0001]
    weight_decay: [0.0001]
    dropout: [0.1, 0.3]
    block_config: [[2, 2, 2], [3, 3, 3]]
  subset_size:
    train : 10000 
    val : 3000
  epochs : 15

  model:
    B1: 2
    B2: 2
    B3: 2 
    residual: True
    batch_norm: True
    fonction: relu
    num_classes: 200

paths:
  runs_dir: "./runs"
  artifacts_dir: "./artifacts"


train_final:
  device: cuda
  optimizer:
    lr: 0.0001
    weight_decay: 0.0001 
  batch_size: 32
  epochs: 200
  warmup_epochs: 5
  first_cycle_epochs: 30
  t_mult: 2
  early_stopping_patience: 200
  max_steps: null

augment_final:
  random_flip: true
  random_crop:
    size: [64, 64]
    scale: [0.60, 1.2]
    ratio: [0.9, 1.1]
  color_jitter:
    brightness: 0.8
    contrast: 0.8
    saturation: 0.8
    hue: 0.1

model_final:
  num_classes: 200
  residual: true
  batch_norm: true
  activation: relu
  residual_blocks: [3, 3, 3]
  dropout: 0.3
  version: "FINAL"